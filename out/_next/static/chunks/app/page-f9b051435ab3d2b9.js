(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9159:function(e,t,i){Promise.resolve().then(i.bind(i,1969))},1969:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return y}});var a=i(7437),n=i(2265),s=i(610),r=i(4340),c=i(9386),l=i(5874),o=i(4937),d=i(3682),u=i(7499),g=i(2081),m=i(530),h=i(6463),p=i(6820),b=i.n(p),f=i(8472),x=i(9842),j=i(95),S=i(947),w=i(5735);function y(){let[e,t]=(0,n.useState)(null),[i,p]=(0,n.useState)(!1),y=(0,n.useRef)(null),z=(0,s.p)(),C=(0,h.useRouter)(),[v,k]=(0,n.useState)(!1),[I,T]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=(0,w.Aj)(j.I,async e=>{e?T(!0):k(!1)});return()=>{e()}},[]);let U=async()=>{try{let t=[],i=new FormData;i.append("image",e);let a=0,n=new Date;await f.Z.post("".concat("https://super-duper-space-engine-x5wp7rjgjgjvc9vq5-5000.app.github.dev","/verify"),i).then(async e=>{if(e.data.username){if(await (0,x.PL)((0,x.IO)((0,x.hJ)(j.db,"Data"),(0,x.ar)("email","==",e.data.username),(0,x.b9)(1))).then(e=>{e.forEach(e=>{t.push({...e.data(),id:e.id})})}),0==t.length)await (0,x.ET)((0,x.hJ)(j.db,"Data"),{email:e.data.username,startTime:n.getTime()}).then(()=>{z({title:"Submitted.",description:"Image verified.",status:"success",duration:5e3,isClosable:!0})});else if(t[0].endTime)await (0,x.ET)((0,x.hJ)(j.db,"Data"),{email:e.data.username,startTime:n.getTime()}).then(()=>{z({title:"Submitted.",description:"Image verified.",status:"success",duration:5e3,isClosable:!0})});else{let i=n.getTime()-t[0].startTime,s="25"*(i/6e4).toFixed(0);await (0,x.r7)((0,x.JU)(j.db,"Data",t[0].id),{endTime:n.getTime(),fare:s}).then(async()=>{await (0,x.QT)((0,x.JU)(j.db,"Users",e.data.username)).then(async t=>{a=t.data().wallet-s,await (0,x.r7)((0,x.JU)(j.db,"Users",e.data.username),{wallet:a}).then(()=>{z({title:"Submitted.",description:"Image verified.",status:"success",duration:5e3,isClosable:!0}),a<10&&z({title:"Low balance.",description:"Kindly recharge your account.",status:"error",duration:5e3,isClosable:!0})})})})}}e.data.message&&z({title:"Error.",description:"Image not verified.",status:"error",duration:5e3,isClosable:!0})})}catch(e){z({title:"Submission failed.",description:"Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{t(null),k(!1)}};return(0,a.jsxs)(r.xu,{w:"100vw",h:"100vh",display:"flex",flexDirection:"column",bg:"gray.900",bgImage:"/image4.jpg",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",alignItems:"center",children:[(0,a.jsxs)(c.U,{w:"100%",justifyContent:"flex-end",p:4,children:[I?(0,a.jsx)(l.z,{colorScheme:"blue",size:"sm",onClick:()=>C.push("/dashboard"),children:"Dashboard"}):(0,a.jsx)(l.z,{colorScheme:"blue",size:"sm",onClick:()=>C.push("/login"),children:"Login"}),(0,a.jsx)(l.z,{colorScheme:"blue",size:"sm",onClick:()=>C.push("/signup"),children:"Signup"})]}),(0,a.jsxs)(o.g,{spacing:6,boxShadow:"lg",p:8,bg:"rgba(0, 0, 0, 0.6)",borderRadius:"xl",w:"90%",maxW:"lg",textAlign:"center",alignSelf:"center",children:[(0,a.jsx)(d.X,{size:"lg",color:"orange.300",children:"Railway Tracking System"}),(0,a.jsx)(u.x,{fontSize:"md",color:"gray.400",children:"A modern way to track fares using facial recognition."}),!i&&(0,a.jsxs)(g.K,{spacing:4,alignItems:"center",children:[(0,a.jsx)(u.x,{fontSize:"sm",color:"white",children:"Select a picture to recognize or use your camera"}),(0,a.jsxs)(c.U,{spacing:4,children:[(0,a.jsxs)(l.z,{as:"label",colorScheme:"blue",size:"md",children:["Select Picture",(0,a.jsx)("input",{type:"file",accept:"image/*",hidden:!0,onChange:e=>{t(e.target.files[0])}})]}),(0,a.jsx)(l.z,{colorScheme:"blue",size:"md",onClick:()=>p(!0),children:"Use Camera"})]})]}),i&&(0,a.jsxs)(o.g,{spacing:4,alignItems:"center",children:[(0,a.jsx)(b(),{audio:!1,ref:y,screenshotFormat:"image/png",width:320,height:240,videoConstraints:{facingMode:"user"}}),(0,a.jsxs)(c.U,{spacing:4,children:[(0,a.jsx)(l.z,{colorScheme:"green",size:"md",onClick:()=>{fetch(y.current.getScreenshot()).then(e=>e.blob()).then(e=>{t(new File([e],"capture.png",{type:"image/png"})),p(!1)})},children:"Capture"}),(0,a.jsx)(l.z,{colorScheme:"red",size:"md",onClick:()=>p(!1),children:"Cancel"})]})]}),e&&(0,a.jsxs)(r.xu,{children:[(0,a.jsx)(u.x,{fontSize:"sm",color:"white",children:"Selected Image:"}),(0,a.jsx)(m.E,{src:URL.createObjectURL(e),alt:"Selected",boxSize:"200px",objectFit:"cover",borderRadius:"md",mt:2})]}),(0,a.jsx)(l.z,{onClick:()=>{k(!0),U()},colorScheme:"blue",size:"md",isDisabled:!e,children:"Submit"})]}),v?(0,a.jsx)(S.Z,{}):null]})}},947:function(e,t,i){"use strict";i.d(t,{Z:function(){return s}});var a=i(7437),n=i(6829);function s(){return(0,a.jsx)("div",{style:{display:"flex",minWidth:"100vw",minHeight:"100vh",alignItems:"center",justifyContent:"center",position:"absolute",backgroundColor:"#00000079"},children:(0,a.jsx)(n.$,{color:"orange.300",size:"lg"})})}},95:function(e,t,i){"use strict";i.d(t,{I:function(){return l},db:function(){return c}});var a=i(5236),n=i(5735),s=i(9842);let r=(0,a.ZF)({apiKey:"AIzaSyBWn8c0M720lkYXMXUOJHDQIDQop62UM8A",authDomain:"railway-facial-tracking.firebaseapp.com",projectId:"railway-facial-tracking",storageBucket:"railway-facial-tracking.appspot.com",messagingSenderId:"413502630264",appId:"1:413502630264:web:c4b4249d43ecdfbd5ac08d"}),c=(0,s.ad)(r),l=(0,n.v0)(r)}},function(e){e.O(0,[358,898,645,642,846,971,23,744],function(){return e(e.s=9159)}),_N_E=e.O()}]);