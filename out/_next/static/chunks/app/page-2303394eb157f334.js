(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9898:function(e,t,a){Promise.resolve().then(a.bind(a,7191))},7191:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return O}});var i=a(7437),n=a(2265),s=a(8636),r=a(6566),l=a(8040),c=a(7537),o=a(9054),d=a(9566),u=a(9957),h=a(3789),m=a(7529),g=a(9983),p=a(8213),f=a(9915),b=a(4644),x=a(9469);let j=(0,b.G)(function(e,t){let{children:a,placeholder:n,className:s,...r}=e;return(0,i.jsxs)(x.m.select,{...r,ref:t,className:(0,f.cx)("chakra-select",s),children:[n&&(0,i.jsx)("option",{value:"",children:n}),a]})});j.displayName="SelectField";var v=a(1379),y=a(7010);let S=(0,b.G)((e,t)=>{var a;let n=(0,y.j)("Select",e),{rootProps:s,placeholder:r,icon:l,color:c,height:o,h:d,minH:u,minHeight:h,iconColor:f,iconSize:b,...S}=(0,m.L)(e),[C,w]=function(e,t){let a={},i={};for(let[n,s]of Object.entries(e))t.includes(n)?a[n]=s:i[n]=s;return[a,i]}(S,g.oE),k=(0,v.Y)(w),_={paddingEnd:"2rem",...n.field,_focus:{zIndex:"unset",...null===(a=n.field)||void 0===a?void 0:a._focus}};return(0,i.jsxs)(x.m.div,{className:"chakra-select__wrapper",__css:{width:"100%",height:"fit-content",position:"relative",color:c},...C,...s,children:[(0,i.jsx)(j,{ref:t,height:null!=d?d:o,minH:null!=u?u:h,placeholder:r,...k,__css:_,children:e.children}),(0,i.jsx)(z,{"data-disabled":(0,p.P)(k.disabled),...(f||c)&&{color:f||c},__css:n.icon,...b&&{fontSize:b},children:l})]})});S.displayName="Select";let C=e=>(0,i.jsx)("svg",{viewBox:"0 0 24 24",...e,children:(0,i.jsx)("path",{fill:"currentColor",d:"M16.59 8.59L12 13.17 7.41 8.59 6 10l6 6 6-6z"})}),w=(0,x.m)("div",{baseStyle:{position:"absolute",display:"inline-flex",alignItems:"center",justifyContent:"center",pointerEvents:"none",top:"50%",transform:"translateY(-50%)"}}),z=e=>{let{children:t=(0,i.jsx)(C,{}),...a}=e,s=(0,n.cloneElement)(t,{role:"presentation",className:"chakra-select__icon",focusable:!1,"aria-hidden":!0,style:{width:"1em",height:"1em",color:"currentColor"}});return(0,i.jsx)(w,{...a,className:"chakra-select__icon-wrapper",children:(0,n.isValidElement)(t)?s:null})};z.displayName="SelectIcon";var k=a(7791),_=a(6463),I=a(6820),E=a.n(I),U=a(8472),N=a(9842),B=a(95),D=a(947),R=a(5186),L=a(9212),A=a.n(L),F=a(357);function O(){let[e,t]=(0,n.useState)(null),[a,m]=(0,n.useState)(!1),g=(0,n.useRef)(null),p=(0,s.p)(),f=(0,_.useRouter)(),[b,x]=(0,n.useState)(!1),[j,v]=(0,n.useState)(!1),[y,C]=(0,n.useState)(""),w=(0,n.useRef)();(0,n.useEffect)(()=>{let e=(0,R.Aj)(B.I,async e=>{e?v(!0):x(!1)});return()=>{e()}},[]);let z=(e,t)=>{let a=[e,t].sort(),i="".concat(a[0],"_").concat(a[1]);return({A_B:parseFloat("10"),A_C:parseFloat("20"),B_C:parseFloat("15")})[i]||0},I=async()=>{try{let t=[],a=new FormData;a.append("image",e);let i=0;await U.Z.post("".concat(F.env.NEXT_PUBLIC_BACKEND_URL,"/verify"),a).then(async e=>{if(e.data.username){if(await (0,N.PL)((0,N.IO)((0,N.hJ)(B.db,"Data"),(0,N.ar)("email","==",e.data.username),(0,N.b9)(1),(0,N.Xo)("timestamp","desc"))).then(e=>{e.forEach(e=>{t.push({...e.data(),id:e.id})})}),0==t.length)await (0,N.ET)((0,N.hJ)(B.db,"Data"),{email:e.data.username,timestamp:A()().valueOf(),start:y}).then(()=>{p({title:"Submitted.",description:"Image verified.",status:"success",duration:5e3,isClosable:!0})});else if(t[0].end)await (0,N.ET)((0,N.hJ)(B.db,"Data"),{email:e.data.username,timestamp:A()().valueOf(),start:y}).then(()=>{p({title:"Submitted.",description:"Image verified.",status:"success",duration:5e3,isClosable:!0})});else{let a=z(t[0].start,y);await (0,N.r7)((0,N.JU)(B.db,"Data",t[0].id),{end:y,fare:a}).then(async()=>{await (0,N.QT)((0,N.JU)(B.db,"Users",e.data.username)).then(async t=>{i=t.data().wallet-a,await (0,N.r7)((0,N.JU)(B.db,"Users",e.data.username),{wallet:i}).then(()=>{p({title:"Submitted.",description:"Image verified.",status:"success",duration:5e3,isClosable:!0}),i<10&&p({title:"Low balance.",description:"Kindly recharge your account.",status:"error",duration:5e3,isClosable:!0})})})})}}e.data.message&&p({title:"Error.",description:"Image not verified.",status:"error",duration:5e3,isClosable:!0})})}catch(e){console.log(e),p({title:"Submission failed.",description:"Please try again.",status:"error",duration:5e3,isClosable:!0})}finally{C(""),t(null),x(!1)}};return(0,i.jsxs)(r.x,{w:"100vw",h:"100vh",display:"flex",flexDirection:"column",bg:"gray.900",bgImage:"/image4.jpg",bgRepeat:"no-repeat",bgSize:"cover",bgPosition:"center",alignItems:"center",children:[(0,i.jsxs)(l.U,{w:"100%",justifyContent:"flex-end",p:4,children:[j?(0,i.jsx)(c.z,{colorScheme:"blue",size:"sm",onClick:()=>f.push("/dashboard"),children:"Dashboard"}):(0,i.jsx)(c.z,{colorScheme:"blue",size:"sm",onClick:()=>f.push("/login"),children:"Login"}),(0,i.jsx)(c.z,{colorScheme:"blue",size:"sm",onClick:()=>f.push("/signup"),children:"Signup"})]}),(0,i.jsxs)(o.g,{spacing:6,boxShadow:"lg",p:8,bg:"rgba(0, 0, 0, 0.6)",borderRadius:"xl",w:"90%",maxW:"lg",textAlign:"center",alignSelf:"center",children:[(0,i.jsx)(d.X,{size:"lg",color:"orange.300",children:"Railway Tracking System"}),(0,i.jsx)(u.x,{fontSize:"md",color:"gray.400",children:"A modern way to track fares using facial recognition."}),!a&&(0,i.jsxs)(h.K,{spacing:4,alignItems:"center",children:[(0,i.jsx)(u.x,{fontSize:"sm",color:"white",children:"Select a picture to recognize or use your camera"}),(0,i.jsxs)(l.U,{spacing:4,children:[(0,i.jsxs)(S,{bg:"transparent",color:"white",w:"200px",value:y,onChange:e=>C(e.target.value),children:[(0,i.jsx)("option",{style:{color:"black"},value:"",children:"Select Camera"}),(0,i.jsx)("option",{style:{color:"black"},value:"A",children:"Camera A"}),(0,i.jsx)("option",{style:{color:"black"},value:"B",children:"Camera B"}),(0,i.jsx)("option",{style:{color:"black"},value:"C",children:"Camera C"})]}),(0,i.jsx)(c.z,{onClick:()=>{var e;return null==w?void 0:null===(e=w.current)||void 0===e?void 0:e.click()},as:"label",colorScheme:"blue",size:"md",children:"Select Picture"}),(0,i.jsx)("input",{style:{display:"none"},ref:w,type:"file",accept:"image/*",hidden:!0,onChange:e=>{t(e.target.files[0])}}),(0,i.jsx)(c.z,{colorScheme:"blue",size:"md",onClick:()=>m(!0),children:"Use Camera"})]})]}),a&&(0,i.jsxs)(o.g,{spacing:4,alignItems:"center",children:[(0,i.jsx)(E(),{audio:!1,ref:g,screenshotFormat:"image/png",width:320,height:240,videoConstraints:{facingMode:"user"}}),(0,i.jsxs)(l.U,{spacing:4,children:[(0,i.jsx)(c.z,{colorScheme:"green",size:"md",onClick:()=>{fetch(g.current.getScreenshot()).then(e=>e.blob()).then(e=>{t(new File([e],"capture.png",{type:"image/png"})),m(!1)})},children:"Capture"}),(0,i.jsx)(c.z,{colorScheme:"red",size:"md",onClick:()=>m(!1),children:"Cancel"})]})]}),e&&(0,i.jsxs)(r.x,{children:[(0,i.jsx)(u.x,{fontSize:"sm",color:"white",children:"Selected Image:"}),(0,i.jsx)(k.E,{src:URL.createObjectURL(e),alt:"Selected",boxSize:"200px",objectFit:"cover",borderRadius:"md",mt:2})]}),(0,i.jsx)(c.z,{onClick:()=>{x(!0),I()},colorScheme:"blue",size:"md",isDisabled:!e||!y,children:"Submit"})]}),b?(0,i.jsx)(D.Z,{}):null]})}},947:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});var i=a(7437),n=a(6925);function s(){return(0,i.jsx)("div",{style:{display:"flex",minWidth:"100vw",minHeight:"100vh",alignItems:"center",justifyContent:"center",position:"absolute",backgroundColor:"#00000079"},children:(0,i.jsx)(n.$,{color:"orange.300",size:"lg"})})}},95:function(e,t,a){"use strict";a.d(t,{I:function(){return c},db:function(){return l}});var i=a(5236),n=a(5186),s=a(9842);let r=(0,i.ZF)({apiKey:"AIzaSyBTfo1RILh_9BcsJxndfgrnKDOcYISoBzc",authDomain:"railway-tracking-aa884.firebaseapp.com",projectId:"railway-tracking-aa884",storageBucket:"railway-tracking-aa884.firebasestorage.app",messagingSenderId:"586688207303",appId:"1:586688207303:web:a31a0c82b4bb4a53b561e2"}),l=(0,s.ad)(r),c=(0,n.v0)(r)}},function(e){e.O(0,[358,533,990,481,561,420,971,23,744],function(){return e(e.s=9898)}),_N_E=e.O()}]);